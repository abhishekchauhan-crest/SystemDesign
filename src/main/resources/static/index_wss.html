<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Chat ðŸ’¬</title>
    <style>
        :root {
          --primary: #0078ff;
          --bg: #f2f5f7;
          --bubble-you: #dcf8c6;
          --bubble-other: #ffffff;
          --text-muted: #888;
        }
        body {
          font-family: "Segoe UI", sans-serif;
          background: var(--bg);
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
        }
        #chat-container {
          width: 800px;
          height: 600px;
          background: white;
          border-radius: 12px;
          display: flex;
          flex-direction: row;
          overflow: hidden;
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        #chat-section {
          flex: 3;
          display: flex;
          flex-direction: column;
        }
        #users-panel {
          flex: 1;
          background: #fafafa;
          border-left: 1px solid #ddd;
          padding: 10px;
          overflow-y: auto;
        }
        #users-panel h3 {
          margin-top: 0;
          text-align: center;
          color: #333;
        }
        .user-item {
          padding: 6px 10px;
          border-radius: 6px;
          margin: 4px 0;
          background: #e8f0fe;
          color: #222;
          font-weight: 500;
        }
        #chat-header {
          background: var(--primary);
          color: white;
          text-align: center;
          padding: 15px;
          font-weight: 600;
          position: relative;
        }
        #status {
          position: absolute;
          right: 10px;
          top: 15px;
          font-size: 0.85em;
        }
        #chat-box {
          flex: 1;
          padding: 15px;
          overflow-y: auto;
          display: flex;
          flex-direction: column;
        }
        .message {
          margin: 5px 0;
          padding: 8px 12px;
          border-radius: 12px;
          max-width: 75%;
          position: relative;
          display: inline-block;
        }
        .you { align-self: flex-end; background: var(--bubble-you); }
        .other { align-self: flex-start; background: var(--bubble-other); }
        .timestamp { font-size: 0.7em; color: var(--text-muted); text-align: right; margin-top: 2px; }
        #input-area {
          display: flex;
          border-top: 1px solid #ddd;
          padding: 10px;
          background: #fafafa;
        }
        #input-area input {
          flex: 1;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 8px;
          font-size: 1em;
        }
        #input-area button {
          margin-left: 8px;
          padding: 10px 15px;
          border: none;
          border-radius: 8px;
          background: var(--primary);
          color: white;
          cursor: pointer;
          font-weight: 600;
        }
        #username-section {
          text-align: center;
          padding: 20px;
        }
        #username-input {
          padding: 8px;
          width: 70%;
          font-size: 1em;
        }
    </style>
</head>
<body>
<div id="chat-container">
    <div id="chat-section">
        <div id="chat-header">
            Real-Time Chat ðŸ’¬
            <span id="status">ðŸ”´ Offline</span>
        </div>

        <div id="username-section">
            <p>Enter your name to join the chat:</p>
            <input id="username-input" type="text" placeholder="Your name..." />
            <button id="join-btn">Join</button>
        </div>

        <div id="chat-box" style="display:none;"></div>

        <div id="input-area" style="display:none;">
            <input id="message-input" type="text" placeholder="Type a message..." />
            <button id="send-btn">Send</button>
        </div>
    </div>

    <div id="users-panel">
        <h3>ðŸŸ¢ Online Users</h3>
        <div id="users-list"></div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      let socket;
      let username = null;
      const chatBox = document.getElementById("chat-box");
      const usersList = document.getElementById("users-list");

      function updateStatus(connected) {
        document.getElementById("status").textContent = connected ? "ðŸŸ¢ Online" : "ðŸ”´ Offline";
      }

      function appendMessage(html, sender = "other") {
        const msgDiv = document.createElement("div");
        msgDiv.classList.add("message", sender);
        msgDiv.innerHTML = html;
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function renderMessage(msg) {
        const { type, username, text, timestamp, users } = msg;

        switch (type) {
          case "system":
            appendMessage(`<em>${text}</em><div class="timestamp">${timestamp}</div>`, "other");
            break;
          case "chat":
            const sender = username === window.username ? "you" : "other";
            const prefix = sender === "you" ? "You" : username;
            appendMessage(`<strong>${prefix}:</strong> ${text}<div class="timestamp">${timestamp}</div>`, sender);
            break;
          case "users":
            updateUserList(users);
            break;
        }
      }

      function updateUserList(users) {
        usersList.innerHTML = "";
        users.forEach(u => {
          const div = document.createElement("div");
          div.classList.add("user-item");
          div.textContent = u === username ? `${u} (You)` : u;
          usersList.appendChild(div);
        });
      }

      document.getElementById("join-btn").onclick = () => {
        username = document.getElementById("username-input").value.trim();
        if (!username) return alert("Please enter a name!");

        document.getElementById("username-section").style.display = "none";
        document.getElementById("chat-box").style.display = "flex";
        document.getElementById("input-area").style.display = "flex";

        socket = new WebSocket("ws://localhost:8080/ws/chat");

        socket.onopen = () => {
          updateStatus(true);
          socket.send(JSON.stringify({ type: "join", username }));
        };

        socket.onmessage = (event) => {
          try {
            renderMessage(JSON.parse(event.data));
          } catch {
            appendMessage(event.data, "other");
          }
        };

        socket.onclose = () => updateStatus(false);
      };

      document.getElementById("send-btn").onclick = sendMessage;

      const input = document.getElementById("message-input");

      function sendMessage() {
        const text = input.value.trim();
        if (text && socket && socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify({ type: "chat", text }));
          input.value = "";
        }
      }
    });
</script>

</body>
</html>